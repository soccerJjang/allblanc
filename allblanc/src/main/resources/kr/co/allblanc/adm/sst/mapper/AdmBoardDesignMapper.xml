<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.allblanc.adm.sst.mapper.AdmBoardDesignMapper">

	<select id="boardDesignTotalCnt" parameterType="admBulletinBoardVO" resultType="int">
		SELECT 
			IFNULL(count(BD.BOARD_DESIGN_SEQ), 0) AS totalCnt
		FROM BOARD_DESIGN BD
		WHERE 1 = 1
			AND BD.USE_AT = 'Y'
			<if test="searchValue != null and searchValue != '' ">
				<choose>
					<when test="searchKey == 'boardSj' ">
						AND BD.BOARD_SJ LIKE CONCAT('%',#{searchValue},'%') 
					</when>
					<when test="searchKey == 'boardCn' ">
						AND BD.BOARD_CN LIKE CONCAT('%',#{searchValue},'%') 
					</when>
					<otherwise>
						AND (
							BD.BOARD_SJ LIKE CONCAT('%',#{searchValue},'%')
							OR
							BD.BOARD_CN LIKE CONCAT('%',#{searchValue},'%')
						) 
					</otherwise>
				</choose>
			</if>
		ORDER BY SORT_ORDR DESC, CREATE_DT DESC
	</select>

	<select id="boardDesignList" parameterType="admBulletinBoardVO" resultType="admBulletinBoardVO">
		SELECT 
			BD.BOARD_DESIGN_SEQ AS boardDesignSeq
			, BD.BOARD_SJ AS boardSj
			, BD.BOARD_CN AS boardCn
			, BD.VIDEO_URL AS videoUrl
			, BD.CATEGORY_SEQ AS categorySeq
			, BD.SORT_ORDR AS sortOrdr
			, BD.READ_CNT as readCnt
			, BD.USE_AT as useAt
			, BD.CREATE_DT AS createDt
			, (SELECT FILE_PATH FROM BOARD_FILE_INFO WHERE BOARD_DESIGN_SEQ = BD.BOARD_DESIGN_SEQ) AS filePath
			, (SELECT NEW_FILE_NM FROM BOARD_FILE_INFO WHERE BOARD_DESIGN_SEQ = BD.BOARD_DESIGN_SEQ) AS newFileNm
			, (SELECT ORIGNL_FILE_NM FROM BOARD_FILE_INFO WHERE BOARD_DESIGN_SEQ = BD.BOARD_DESIGN_SEQ) AS originalFileNm
		FROM BOARD_DESIGN BD
		WHERE 1 = 1
			AND BD.USE_AT = 'Y'
			<if test="searchValue != null and searchValue != '' ">
				<choose>
					<when test="searchKey == 'boardSj' ">
						AND BD.BOARD_SJ LIKE CONCAT('%',#{searchValue},'%') 
					</when>
					<when test="searchKey == 'boardCn' ">
						AND BD.BOARD_CN LIKE CONCAT('%',#{searchValue},'%') 
					</when>
					<otherwise>
						AND (
							BD.BOARD_SJ LIKE CONCAT('%',#{searchValue},'%')
							OR
							BD.BOARD_CN LIKE CONCAT('%',#{searchValue},'%')
						) 
					</otherwise>
				</choose>
			</if>
		ORDER BY SORT_ORDR DESC, CREATE_DT DESC
		LIMIT #{firstIndex}, #{recordCountPerPage} 
	</select>

	<select id="boardDesignDetail" parameterType="admBulletinBoardVO" resultType="admBulletinBoardVO">
		SELECT 
			BD.BOARD_DESIGN_SEQ AS boardDesignSeq
			, BD.BOARD_SJ AS boardSj
			, BD.BOARD_CN AS boardCn
			, BD.VIDEO_URL AS videoUrl
			, BD.CATEGORY_SEQ AS categorySeq
			, BD.SORT_ORDR AS sortOrdr
			, BD.READ_CNT as readCnt
			, BD.USE_AT as useAt
			, BD.CREATE_DT AS createDt
			, (SELECT FILE_PATH FROM BOARD_FILE_INFO WHERE BOARD_DESIGN_SEQ = BD.BOARD_DESIGN_SEQ) AS filePath
			, (SELECT NEW_FILE_NM FROM BOARD_FILE_INFO WHERE BOARD_DESIGN_SEQ = BD.BOARD_DESIGN_SEQ) AS newFileNm
			, (SELECT ORIGNL_FILE_NM FROM BOARD_FILE_INFO WHERE BOARD_DESIGN_SEQ = BD.BOARD_DESIGN_SEQ) AS originalFileNm
		FROM BOARD_DESIGN BD
		WHERE BD.BOARD_DESIGN_SEQ = #{boardDesignSeq}
			AND BD.USE_AT = 'Y'
		ORDER BY SORT_ORDR DESC, CREATE_DT DESC
	</select>
	
	<insert id="boardDesignRegistration" useGeneratedKeys="true" parameterType="admBulletinBoardVO">
		INSERT INTO BOARD_DESIGN
		(
			BOARD_DESIGN_SEQ
			, BOARD_SEQ
			, BOARD_SJ
			, BOARD_CN
			, VIDEO_URL
			, CATEGORY_SEQ
			, SORT_ORDR
			, USE_AT
			, CREATE_DT
		)
		VALUES
		(
			(SELECT seqNextval('BOARD_DESIGN') FROM DUAL)
			, #{boardSeq}
			, #{boardSj}
			, #{boardCn}
			, #{videoUrl}
			, #{categorySeq}
			, (SELECT IFNULL(MAX(SORT_ORDR), 0)+1 FROM BOARD_DESIGN AS BD)
			, 'Y'
			, SYSDATE()
		)
		<selectKey keyProperty="boardDesignSeq" resultType="int" order="AFTER">
			SELECT CURRVAL AS boardDesignSeq FROM UID_SEQ WHERE TABLE_NAME = 'BOARD_DESIGN'
		</selectKey>
	</insert>
	
	<update id="boardDesignModification" parameterType="admBulletinBoardVO">
		UPDATE BOARD_DESIGN
		SET
			BOARD_SJ = #{boardSj}
			, BOARD_CN = #{boardCn}
			, VIDEO_URL = #{videoUrl}
			, CATEGORY_SEQ = #{categorySeq}
		WHERE BOARD_DESIGN_SEQ = #{boardDesignSeq}
	</update>
	
	<delete id="boardDesignDeletion" parameterType="admBulletinBoardVO">
		DELETE FROM BOARD_DESIGN
		WHERE BOARD_DESIGN_SEQ = #{boardDesignSeq}
	</delete>
	
	<update id="boardDesignOrdrUpdate" parameterType="admBulletinBoardVO">
		UPDATE BOARD_DESIGN
		SET
			SORT_ORDR = #{sortOrdr}
		WHERE BOARD_DESIGN_SEQ = #{boardDesignSeq}
	</update>
	
	<select id="boardDesignPreDetail" parameterType="admBulletinBoardVO" resultType="admBulletinBoardVO">
		SELECT 
			BD.BOARD_DESIGN_SEQ AS boardDesignSeq
			, BD.BOARD_SJ AS boardSj
			, BD.BOARD_CN AS boardCn
			, BD.SORT_ORDR AS sortOrdr
			, BD.READ_CNT as readCnt
			, BD.USE_AT as useAt
			, BD.CREATE_DT AS createDt
		FROM BOARD_DESIGN BD
		WHERE BD.BOARD_DESIGN_SEQ <![CDATA[ <> ]]> #{boardDesignSeq}
			AND BD.USE_AT = 'Y'
			AND BD.SORT_ORDR <![CDATA[ > ]]> #{sortOrdr}
		ORDER BY SORT_ORDR ASC, CREATE_DT DESC
		LIMIT 1
	</select>
	
	<select id="boardDesignNextDetail" parameterType="admBulletinBoardVO" resultType="admBulletinBoardVO">
		SELECT 
			BD.BOARD_DESIGN_SEQ AS boardDesignSeq
			, BD.BOARD_SJ AS boardSj
			, BD.BOARD_CN AS boardCn
			, BD.SORT_ORDR AS sortOrdr
			, BD.READ_CNT as readCnt
			, BD.USE_AT as useAt
			, BD.CREATE_DT AS createDt
		FROM BOARD_DESIGN BD
		WHERE BD.BOARD_DESIGN_SEQ <![CDATA[ <> ]]> #{boardDesignSeq}
			AND BD.USE_AT = 'Y'
			AND BD.SORT_ORDR <![CDATA[ < ]]> #{sortOrdr}
		ORDER BY SORT_ORDR DESC, CREATE_DT DESC
		LIMIT 1
	</select>
</mapper>
